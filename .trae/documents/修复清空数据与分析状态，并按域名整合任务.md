## 问题分析
- 模型配置来源与使用：`options/js/components/ModelManager.js:25-35` 读取/保存 `aiModels`，并在保存前调用 `testModelConnection()`（`ModelManager.js:352-380`）。
- 清空数据实现：`options/js/main.js:350-358` 调用 `StorageManager.clearSnapshots()` 与 `StorageManager.clearConfig()`，而 `clearConfig()` 是全量清空 `chrome.storage.local`（`options/js/utils/storage.js:28-30`），会误删 `aiModels`、`generateConfig` 等配置。
- 页面提取与任务：提取器在 `content/extractor.js:18-71`，后台队列在 `background/task-manager.js:113-208`，提取后设置 `status = 'analyzing'`（`task-manager.js:156-159`）并进行 AI 分析（`task-manager.js:260-273`）。
- 弹窗状态显示：`popup/popup.js:317-357` 仅处理 `pending/running/completed/failed`，未覆盖 `analyzing`，导致“分析中”无状态反馈。
- 批量任务方式：当前批量按每个 URL 逐一入队（`popup/popup.js:238-260`、`task-manager.js:77-86`），未按域名整合展示或管理。

## 修复清空数据误删配置
1. 将清理逻辑改为可选择清理项：
   - 在 `OptionsApp.clearData()`（`options/js/main.js:350-358`）拆分为：仅清理快照（IndexedDB）、仅清理任务（`chrome.storage.local.tasks`）、清理全部（需明确二次确认）。
2. 扩展 `StorageManager`（`options/js/utils/storage.js`）：新增方法只删除指定键：`removeKeys(['tasks','history',...])`；保留 `aiModels`、`generateConfig`、`aiConfig`。
3. 选项页 UI 增加单选/多选“清理范围”，默认不勾选“模型配置”。

## 优化“分析中”状态显示
1. 后台：`task-manager.js:getStats()`（`background/task-manager.js:324-333`）增加 `analyzing` 统计，并在 `notifyUpdate()` 推送。
2. 弹窗：`popup/popup.js:createTaskItem()`（`popup/popup.js:317-360`）增加 `analyzing` 图标与文案“分析中”，进度可显示 85%→95%。
3. 弹窗统计：`updateStats()`（`popup/popup.js:365-392`）展示 `analyzing` 数量；徽章在有 `running` 或 `analyzing` 时显示。
4. 历史页：为生成分析中/失败提供可视化提示（`options/js/main.js:149-193`），避免“生成分析”按钮无反馈。

## 任务按域名整合
1. 引入“域名任务（Domain Job）”概念：一个 Job 绑定一个域名与若干 URL 子任务，提供总进度、数量与失败计数。
2. 后台：
   - 新增结构：`jobs: Map(jobId → { domain, taskIds, status, progress, stats })`；任务增加 `jobId`、`domain`。
   - 新增消息类型：`ADD_DOMAIN_JOB`（给定域名与路由集），后台创建 Job 并批量生成任务（复用现有 `addBatchTasks`）。
   - 更新 `getStats()` 返回域名统计；新增 `GET_JOBS/GET_JOB_STATS` 以供弹窗展示。
3. 路由扫描：继续使用 `RouteScanner`（`content/route-scanner.js:112-136`）的分组结果，默认按当前标签页域名生成一个 Job；支持按分组选择生成子任务。
4. 弹窗与列表 UI：新增域名 Job 卡片（显示域名、总任务数/完成数、总体进度），点击展开查看具体 URL 子任务。

## 兼容性与健壮性改进（可选）
- `AIAnalyzer.parseResponse()`（`lib/ai-analyzer.js:160-176`）增强对 ```json 代码块的解析与回退策略，避免正则误截断。
- `ModelManager.testModelConnection()`（`options/js/components/ModelManager.js:352-380`）支持多个提供商探测策略或允许跳过连接测试。

## 验证与回归
- 手动流程：添加模型→批量提取→查看队列“分析中”状态→生成与下载报告→清理任务与快照→检查模型配置仍在。
- 数据持久化：重载扩展后，任务与 Job 状态正确恢复；清理操作不影响模型与生成配置。
- 大型站点：路由扫描对 `/sitemap.xml` 的调用次数受限，避免阻塞；域名 Job 的并发控制保持 `maxConcurrent = 1` 或按域名限速。

请确认以上方案后，我将开始逐项实现与验证。